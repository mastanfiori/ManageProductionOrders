/*
 * Copyright (C) 2009-2021 SAP SE or an SAP affiliate company. All rights reserved.
 */
sap.ui.define(["i2d/mpe/orders/manages1/controller/BaseController","sap/i2d/mpe/lib/commons1/blocks/OrderDetailsHeaderHelper","sap/ui/model/resource/ResourceModel","sap/ui/model/json/JSONModel","sap/ui/core/routing/History","i2d/mpe/orders/manages1/model/formatter","sap/i2d/mpe/lib/commons1/utils/formatter","sap/i2d/mpe/lib/commons1/utils/util","sap/i2d/mpe/lib/commons1/fragments/OrderOperationStatus","sap/i2d/mpe/lib/popovers1/fragments/MaterialController","sap/m/MessageToast","sap/m/MessageBox","sap/ui/model/Filter","sap/i2d/mpe/lib/commons1/fragments/ApplyHoldDialog","sap/i2d/mpe/lib/commons1/utils/constants","sap/i2d/mpe/lib/qmcomps1/util/Defects","sap/i2d/mpe/lib/qmcomps1/util/Formatter","sap/i2d/mpe/lib/commons1/fragments/OrdSpcfcChange","sap/i2d/mpe/lib/commons1/utils/NavHelper","i2d/mpe/orders/manages1/fragments/OrderSplitDialog"],function(B,O,R,J,H,f,c,r,d,M,e,g,F,A,h,D,k,l,N,m){"use strict";return B.extend("i2d.mpe.orders.manages1.controller.Object",{formatter:f,commonFormatter:c,reuseUtil:r,defectFormatter:k,onInit:function(){var o,v=new J({busy:true,isOrderSplitEnabled:false,OperationForOrderSplit:{},delay:0});var E=sap.ui.getCore().getEventBus();E.subscribe("AppState","hanldeAppstateDetailChanges",this.hanldeAppstateDetailChanges,this);this._oOneOrderReleaseButton=this.getView().byId("idOneOrderReleaseButton");this.getRouter().getRoute("object").attachPatternMatched(this._handleRouteMatched,this);o=this.getView().getBusyIndicatorDelay();this.setModel(v,"objectView");this.getOwnerComponent().getModel().metadataLoaded().then(function(){v.setProperty("/delay",o);});var a=this.getView().byId("idOrderObjectPageLayout");f.setObjectPageLayoutReference(a);c.setObjectPageLayoutReference(a);r.setObjectPageRefrence(this);this.setModel(new J({sSelectedKey:"Standard"}),"sequenceGraph");var s=new J();this.getView().setModel(s,"shopflooritems");var b=this.getOwnerComponent().getModel("DetailModel");var i=b.getData();if(i.bEnableAutoBinding){this._bDetailsScreenInitialLoad=true;}else{this._bDetailsScreenInitialLoad=false;}this._oCommonsI18nModel=this.getCommonsI18nModel();this.getView().setModel(this._oCommonsI18nModel,"common_i18n");c._i18n=this._oCommonsI18nModel;c.loadI18NFile();this.setModel(new J({"EditButtonVisible":false,"ConfirmButtonVisible":false,"bIsDisplayOrderSpecificHoldAvailable":false,"bIsDisplayOrderSpecificHoldNavigable":false,"bIsOrderSpecificHoldAvailable":false}),"ActionButtonVisiblity");if(sap.ushell&&sap.ushell.Container){var S=[];S.push("#ProductionOrder-change");S.push("#ShopFloorRouting-change");sap.ushell.Container.getService("CrossApplicationNavigation").isIntentSupported(S).done(function(C){if(C){this.getModel("ActionButtonVisiblity").setProperty("/EditButtonVisible",C["#ProductionOrder-change"].supported);this.getModel("ActionButtonVisiblity").setProperty("/bIsDisplayOrderSpecificHoldNavigable",C["#ShopFloorRouting-change"].supported);}}.bind(this)).fail(function(){jQuery.sap.log.error("Reading intent data failed.");this.getModel("ActionButtonVisiblity").setProperty("/EditButtonVisible",true);this.getModel("ActionButtonVisiblity").setProperty("/ConfirmButtonVisible",true);this.getModel("ActionButtonVisiblity").setProperty("/bIsDisplayOrderSpecificHoldNavigable",true);});}else{this.getModel("ActionButtonVisiblity").setProperty("/EditButtonVisible",true);this.getModel("ActionButtonVisiblity").setProperty("/bIsDisplayOrderSpecificHoldNavigable",true);}O.onInit(this._oOneOrderReleaseButton,a,this.getView());var j=this.getEventBusParameters();var E=sap.ui.getCore().getEventBus();E.subscribe(j.ApplyHoldDialog.Channel,j.ApplyHoldDialog.Event,j.ApplyHoldDialog.Callback,this);E.subscribe(j.ReleaseOrderAnyway.Channel,j.ReleaseOrderAnyway.Event,j.ReleaseOrderAnyway.Callback,this);A.setEventBusParameters(E,j.ApplyHoldDialog.Channel,j.ApplyHoldDialog.Event);this._DefectsClass=new D();},onNavToDefect:function(E){this._DefectsClass.onNavToDefect(E);},defectsCallbackFn:function(a){},getCommonsI18nModel:function(){var i=jQuery.sap.getModulePath("sap.i2d.mpe.lib.commons1")+"/"+"i18n/i18n.properties";var I=new R({bundleUrl:i});return I;},getOrderNumber:function(s){return O.getOrderNumber(s);},getI18NText:function(i,v){if(v){return this._oCommonsI18nModel.getResourceBundle().getText(i,v);}else{return this._oCommonsI18nModel.getResourceBundle().getText(i);}},_handleRouteMatched:function(E){var o=E.getParameter("arguments").orderId;this.gsOrderId=o;this.iAppState=E.getParameter("arguments").iAppState;this.getModel().metadataLoaded().then(function(){this._bindView("/"+o);}.bind(this));this.updateOrderModel();var a=E.getParameter("arguments").iAppState;var C=E.getParameter("config").name;this.getOwnerComponent().extractInnerAppStateFromURL(a,C,o);},_bindView:function(o){var t=this;var v=this.getModel("objectView"),a=this.getModel();var E=this._getFieldExtensionColumns(a);var s=this._getStatusColumns(a,o);var S="ManufacturingOrder,OrderIsShopFloorOrder,ProductConfiguration,OrderStatusInternalID,MfgFeatureIsActiveInAnyPlant,ManufacturingFeature,"+"ManufacturingFeatureIsActive,Material,MaterialName,MRPControllerName,MfgOrderPlannedTotalQty,ProductionUnit,EffectivityParameterDesc,"+"EffctyTypeCnctntdParamDesc,OrderHasMissingComponents,OrderHasQualityIssue,InspHasRejectedCharc,OrderInternalBillOfOperations,"+"InspHasRejectedInspSubset,InspHasRejectedInspLot,MfgOrderConfirmedScrapQty,OrderYieldDeviationQty,OrderMissingQuantity,OrderExecutionEndIsLate,"+"OrderExecutionStartIsLate,ExecutionEndLatenessInMinutes,ExecutionStartLatenessInMins,ProductionPlant,MRPArea,MRPAreaText,MRPPlant,MRPPlantName,"+"ProductionLine,ProductionVersion,ProductionVersionText,ManufacturingOrderImportance,MRPController,MfgOrderSuperiorMfgOrder,WBSElement,WBSDescription,"+"SalesDocument,SalesDocumentItem,CustomerName,ProdnProcgFlexibilityIndName,MfgOrderScheduledStartDate,MfgOrderScheduledEndDate,MfgOrderScheduledStartTime,"+"MfgOrderScheduledEndTime,MfgOrderActualStartDate,MfgOrderActualStartTime,MfgOrderActualEndDate,MfgOrderPlannedStartDate,MfgOrderPlannedStartTime,"+"MfgOrderPlannedEndDate,MfgOrderPlannedEndTime,MfgOrderScheduledReleaseDate,MfgOrderPlannedYieldQty,MfgOrderConfirmedYieldQty,ActualDeliveredQuantity,"+"OrderOpenQuantity,ManufacturingOrderOperation,MfgOrderOperationText,ManufacturingOrderType,ManufacturingOrderTypeName,IsCloudSystem,"+"BasicSchedulingType,MfgOrderSplitStatus";a.setUseBatch(false);this.getView().bindElement({path:o,parameters:{select:S+E+s},events:{change:this._onBindingChange.bind(this),dataRequested:function(){t.getModel().metadataLoaded().then(function(){v.setProperty("/busy",true);});},dataReceived:function(b){v.setProperty("/busy",false);}}});v.setProperty("/isOrderSplitEnabled",false);},_getFieldExtensionColumns:function(o){var E=o.oMetadata._getEntityTypeByName("C_ManageProductionOrderType");var C="";if(E){var a=E.property;a.forEach(function(I,b){if(I.name.match(/YY1_/gi)&&I.name.match(/YY1_/gi).length>0){C=C+","+I.name;}},this);}return C;},_getStatusColumns:function(o,p){var s=["OrderIsCreated","OrderIsReleased","OrderIsPrinted","OrderIsConfirmed","OrderIsPartiallyConfirmed","OrderIsDelivered","OrderIsDeleted","OrderIsPreCosted","SettlementRuleIsCreated","OrderIsPartiallyReleased","OrderIsTechnicallyCompleted","OrderIsClosed","OrderIsPartiallyDelivered","OrderIsLocked","SettlementRuleIsCrtedManually","OrderIsScheduled","OrderHasGeneratedOperations","OrderIsToBeHandledInBatches","MaterialAvailyIsNotChecked"];var b=o.getProperty(p);var C="",i=0;if(b!==undefined){for(i=0;i<s.length;i++){if(!b.hasOwnProperty(s[i])){C=C+","+s[i];}}}else{for(i=0;i<s.length;i++){C=C+","+s[i];}}return C;},_onBindingChange:function(a,b){var v=this.getView(),V=this.getModel("objectView"),E=v.getElementBinding(),C;if(this.getView().getBindingContext()&&this.getView().getBindingContext().getObject()){C=this.getView().getBindingContext().getObject();}else{C=this.getModel().getContext(E.getPath()).getObject();}if(!E.getBoundContext()){this.getRouter().getTargets().display("objectNotFound");return;}if(this._bDetailsScreenInitialLoad===false){this.rebindAllTablesOfAllBlocks();}else{var s=this.getView().getModel("shopflooritems");if(C.OrderIsShopFloorOrder==="X"){s.setData([""]);}else{s.setData([]);}this._bDetailsScreenInitialLoad=false;}if(C.OrderIsShopFloorOrder==="X"&&f.getButtonStatus(C)){r.checkOprHasOpenOrdSpcfcChange(this.getModel("OSR"),C,function(p){if(p.results.length===0){this.getModel("ActionButtonVisiblity").setProperty("/bIsOrderSpecificHoldAvailable",true);this.getModel("ActionButtonVisiblity").setProperty("/bIsDisplayOrderSpecificHoldAvailable",false);}else if(p.results.length>0&&p.results[0].BillOfOperationsGroup!==""&&p.results[0].BillOfOperationsType!==""&&p.results[0].BillOfOperationsVariant!==""&&p.results[0].BillOfOperationsVersion!==""){if(p.results[0].BillOfOperationsVersionStatus==="10"){this.getModel("ActionButtonVisiblity").setProperty("/bIsOrderSpecificHoldAvailable",false);this.getModel("ActionButtonVisiblity").setProperty("/bIsDisplayOrderSpecificHoldAvailable",true);}else{this.getModel("ActionButtonVisiblity").setProperty("/bIsOrderSpecificHoldAvailable",true);this.getModel("ActionButtonVisiblity").setProperty("/bIsDisplayOrderSpecificHoldAvailable",false);}}this.getModel("objectView").setProperty("/oOrderSpecificChangeDetails",p.results[0]);}.bind(this));}else{this.getModel("ActionButtonVisiblity").setProperty("/bIsOrderSpecificHoldAvailable",false);this.getModel("ActionButtonVisiblity").setProperty("/bIsDisplayOrderSpecificHoldAvailable",false);}if(C.OrderIsShopFloorOrder==="X"){var i=this.getView().createId("idOrderFragDefectMessageStrip");var j=this.getView().createId("idObjectFragDefectRecordingList");var o=this.getView().getModel("Defects");var n={};n.ProductionOrder=C.ManufacturingOrder;this._DefectsClass.setProperties(this,this.getView().getBindingContext(),i,j,n,o);}V.setProperty("/busy",false);},updateOrderModel:function(){var o=this.getView().getModel("DetailModel");var a=o.getData();a.orderId=this.gsOrderId;a=this.updateGraphicFlags(a);o.setData(a);var i=this.getOwnerComponent().getModel("AppState");var p=i.getProperty("/appState");if(a.detailPage!==undefined){p.detailPage=a;}else{p.detailPage=a.detailPage;}this.getOwnerComponent().updateAppStateFromAppStateModel();},updateGraphicFlags:function(o){if(o.bSequenceTableVisible===undefined&&o.bSequenceGraphVisible===undefined&&o.bSequenceGraphRequired===undefined){o.bSequenceTableVisible=true;o.bSequenceGraphVisible=false;o.bSequenceGraphRequired=true;}else if(o.bSequenceTableVisible!==undefined&&o.bSequenceGraphVisible!==undefined&&o.bSequenceGraphRequired!==undefined){o.bSequenceTableVisible=o.bSequenceTableVisible;o.bSequenceGraphVisible=o.bSequenceGraphVisible;o.bSequenceGraphRequired=o.bSequenceGraphRequired;}return o;},rebindAllTablesOfAllBlocks:function(){var b=this.getView().getBindingContext();var o=this.getView().getModel();var s=o.getProperty("OrderIsShopFloorOrder",b);var a=s==="X"?true:false;O.rebindAllTablesOfAllBlocks(a);if(!a){var S=this.getView().getModel("shopflooritems");S.setData([]);}var i=this.getView().getModel("DetailModel");var j=i.getData();if(j.bSequenceGraphVisible===true){this.reuseUtil.getGraphData(this.getView().getModel(),this.getGraphFilterData());}},getGraphFilterData:function(){var s=this.getView().getBindingContext().getObject();var a=[];if(s.ManufacturingOrder){a.push(new sap.ui.model.Filter("ManufacturingOrder",sap.ui.model.FilterOperator.EQ,s.ManufacturingOrder));a.push(new sap.ui.model.Filter("OperationIsDeleted",sap.ui.model.FilterOperator.NE,"X"));a.push(new sap.ui.model.Filter("ManufacturingOrderSubOperation",sap.ui.model.FilterOperator.EQ,""));}return a;},handleEditOrderPress:function(){var o=this.getView().getBindingContext().getObject().ManufacturingOrder;O.handleEditOrderPress(o);},handleConfirmOrderPress:function(E){var o=E.getSource().getModel().oData[this.gsOrderId].ManufacturingOrder;var p={"CORUF-AUFNR":o};var a=sap.ushell&&sap.ushell.Container&&sap.ushell.Container.getService;var C=a&&a("CrossApplicationNavigation");var s="ProductionOrderConfirmation";var b="createOrderConfirmation";O.handleConfirmOrderPress(p,C,s,b);},handleStatusLinkPress:function(E){O.handleStatusLinkPress(E,this);},handleMaterialLinkPress:function(E){var C=E.getSource().getBindingContext();var o=C.getModel();var p=o.getProperty("ProductionPlant",C);var s=o.getProperty("Material",C);O.handleMaterialLinkPress(E,this,s,p);},handleWorkCenterPress:function(E){O.handleWorkCenterPress(E,this);},hanldeAppstateDetailChanges:function(E,a,o){var b=this.getOwnerComponent().getModel("DetailModel");var i=b.getData();i.orderId=o.orderId;i.bSequenceTableVisible=o.bSequenceTableVisible;i.bSequenceGraphVisible=o.bSequenceGraphVisible;i.bSequenceGraphRequired=o.bSequenceGraphRequired;if(o.selectedOrderData){i.selectedOrderData=o.selectedOrderData;}b.setData(i);},onExit:function(){var E=sap.ui.getCore().getEventBus();E.unsubscribe("AppState","hanldeAppstateDetailChanges",this.hanldeAppstateDetailChanges,this);var o=this.getEventBusParameters();E.unsubscribe(o.ApplyHoldDialog.Channel,o.ApplyHoldDialog.Event,o.ApplyHoldDialog.Callback,this);E.unsubscribe(o.ReleaseOrderAnyway.Channel,o.ReleaseOrderAnyway.Event,o.ReleaseOrderAnyway.Callback,this);},handleReleaseOrderPress:function(E){var o=E.getSource().getModel().oData[this.gsOrderId].ManufacturingOrder;this.getModel("PRODORD").refresh(false,true);var L=this.getView().getModel();var C=!!this.getView().$().closest(".sapUiSizeCompact").length;var a=this.getModel("HoldModel");this.oIssuesBlock=this.byId("idIssuesBlock-Collapsed");this.oIssuesBlock.oParentBlock=this.getView().byId("idIssuesSubSection");var b=this.getView().byId("idOrderObjectPageLayout-OPHeaderContent");O.handleReleaseOrderPress(b,o,L,this.oIssuesBlock,C,a);var i=sap.ui.getCore().getEventBus();var j=this.getEventBusParameters();O.setEventBusParameters(i,j.ReleaseOrderAnyway.Channel,j.ReleaseOrderAnyway.Event);},handleOrderHoldButton:function(E){var C=E.getSource().getBindingContext();var o=C.getModel();var s=E.getSource().getModel().oData[this.gsOrderId].ManufacturingOrder;var p=o.getProperty("ProductionPlant",C);var a=o.getProperty("Material",C);var L=this.getView().getModel();var b=!!this.getView().$().closest(".sapUiSizeCompact").length;this.oIssuesBlock=this.byId("idIssuesBlock-Collapsed");this.oIssuesBlock.oParentBlock=this.getView().byId("idIssuesSubSection");var i={ManufacturingOrder:s,ProductionPlant:p,Material:a};var j=[h.HOLD.TYPE_ORDER,h.HOLD.TYPE_MATERIAL];A.setResourceModel(this._oCommonsI18nModel);A.initAndOpen(i,this.getModel("HoldModel"),j,undefined,h.HOLD.TYPE_ORDER,false);},getEventBusParameters:function(){var E={ApplyHoldDialog:{Channel:"sap.i2d.mpe.orders.manages1.Worklist",Event:"onHoldSuccessfullyApplied",Callback:this.onHoldSuccessfullyComplete},ReleaseOrderAnyway:{Channel:"sap.i2d.mpe.orders.manages1.Object",Event:"onReleaseOrderAnywayAppliedDetails",Callback:this.onReleaseOrderAnywayCallback}};return E;},onReleaseOrderAnywayCallback:function(C,E,o){var s=this.getView().getModel().oData[this.gsOrderId].ManufacturingOrder;this.getModel("PRODORD").refresh(false,true);var L=this.getView().getModel();var b;if(this.getView().$){b=!!this.getView().$().closest(".sapUiSizeCompact").length;}var a=this.getModel("HoldModel");this.oIssuesBlock=this.byId("idIssuesBlock-Collapsed");this.oIssuesBlock.oParentBlock=this.getView().byId("idIssuesSubSection");var i=this.getView().byId("idOrderObjectPageLayout-OPHeaderContent");O.handleReleaseOrderPress(i,s,L,this.oIssuesBlock,b,a,true);O.setEventBusParameters();},onHoldSuccessfullyComplete:function(C,E,o){var s,a;if(o.success){s=o.info;e.show(s);this.rebindAllTablesOfAllBlocks();}else{var b=!!this.getView().$().closest(".sapUiSizeCompact").length;s=o.info;this.getDynamicMessageBox(s,g.Icon.ERROR,"Error",[g.Action.CLOSE],"ErrorOrderMSG",a,b);}},getDynamicMessageBox:function(s,i,a,b,j,n,C){O.getDynamicMessageBox(s,i,a,b,j,n,C);},handleRereadButtonPress:function(E){var o=E.getSource().getModel().oData[this.gsOrderId].ManufacturingOrder;this.getModel("PRODORD").refresh(false,true);var L=this.getView().getModel();var C=!!this.getView().$().closest(".sapUiSizeCompact").length;var v=this.getModel("objectView");var a=this.getModel("HoldModel");this.oIssuesBlock=this.byId("idIssuesBlock-Collapsed").getController();O.handleRereadButtonPress(o,L,this.oIssuesBlock,C,v,a);},onPressGoToConfigPage:function(E){var C=E.getSource().getBindingContext();var o=C.getModel();var s=this.getView().getBindingContext().getObject().ManufacturingOrder;var p=o.getProperty("ProductConfiguration",C);var a=sap.ui.core.UIComponent.getRouterFor(this);a.navTo("Configuration",{orderId:s});},onPressOrdSpcfcChange:function(){l.initAndOpen({oHoldModel:this.getView().getModel("HoldModel"),oCRModel:this.getView().getModel("CR"),oOSRModel:this.getView().getModel("OSR"),oSelectedOrder:this.getView().getBindingContext().getObject(),oOrderSpecificChangeDetails:this.getView().getModel("objectView").getProperty("/oOrderSpecificChangeDetails"),oCallBack:this.onOrdSpcfcChangeCallBackObject.bind(this),Ischangeforwholeorder:true});},onPressDisplayOrdScpfcChange:function(E){N.navToShopFloorRoutingChange(this.getView().getModel("objectView").getProperty("/oOrderSpecificChangeDetails"));},onPressOkRelatedOrders:function(E){this._oRelatedOrdersDialog.close();},onPressGraphRelatedOrders:function(E){sap.ui.getCore().byId("idRelatedOrdersInnerTable").setVisible(false);sap.ui.getCore().byId("idRelatedOrdersSmartTable").setShowRowCount(false);sap.ui.getCore().byId("idRelatedOrdersGraph").setVisible(true);sap.ui.getCore().byId("idRelatedOrdersTableButton").setPressed(false);var t=this;var s="/C_MfgOrderSplitOrderDetail";var S=t.getView().getModel().createKey(s,{ManufacturingOrder:this.getView().getModel("RelatedOrdersData").getProperty("/ManufacturingOrder")});var o;var a=[];if(this.getView().getModel("RelatedOrdersData").getProperty("/MfgOrderSplitStatus")==="2"){this.getView().getModel().read(S,{success:function(b){t.getView().getModel("RelatedOrdersData").setProperty("/MfgOrderSplitLeadingOrder",b.MfgOrderSplitLeadingOrder);o=new sap.ui.model.Filter("MfgOrderSplitLeadingOrder",sap.ui.model.FilterOperator.EQ,t.getView().getModel("RelatedOrdersData").getProperty("/MfgOrderSplitLeadingOrder"));a=[];a.push(o);t.getView().getModel().read(s,{filters:a,success:function(n){var p=n.results;var I=false;if(p.length>0){for(var i=0;i<p.length;i++){if(p[i].ManufacturingOrder===t.getView().getModel("RelatedOrdersData").getProperty("/ManufacturingOrder")){I=true;}sap.ui.getCore().byId("idRelatedOrdersGraph").addNode(new sap.suite.ui.commons.networkgraph.Node({key:i,title:p[i].ManufacturingOrder,shape:"Box",selected:I,"attributes":[{"label":t.getView().getModel("i18n").getResourceBundle().getText("relatedOrdersMaterial"),"value":p[i].Material},{"label":t.getView().getModel("i18n").getResourceBundle().getText("relatedOrdersOrderType"),"value":p[i].ManufacturingOrderType},{"label":t.getView().getModel("i18n").getResourceBundle().getText("relatedOrdersWBS"),"value":p[i].WBSElement},{"label":t.getView().getModel("i18n").getResourceBundle().getText("relatedOrdersQuantityColumn"),"value":p[i].MfgOrderPlannedTotalQty}]}));I=false;for(var j=0;j<p.length;j++){if(p[j].MfgOrderSplitParentOrder===p[i].ManufacturingOrder){sap.ui.getCore().byId("idRelatedOrdersGraph").addLine(new sap.suite.ui.commons.networkgraph.Line({from:i,to:j}));}}}}},error:function(i){jQuery.sap.log.error(i.responseText);}});},error:function(b){jQuery.sap.log.error(b.responseText);}});}else{o=new sap.ui.model.Filter("MfgOrderSplitLeadingOrder",sap.ui.model.FilterOperator.EQ,this.getView().getModel("RelatedOrdersData").getProperty("/MfgOrderSplitLeadingOrder"));a=[];a.push(o);this.getView().getModel().read(s,{filters:a,success:function(b){var n=b.results;var I=false;if(n.length>0){for(var i=0;i<n.length;i++){if(n[i].ManufacturingOrder===t.getView().getModel("RelatedOrdersData").getProperty("/ManufacturingOrder")){I=true;}sap.ui.getCore().byId("idRelatedOrdersGraph").addNode(new sap.suite.ui.commons.networkgraph.Node({key:i,title:n[i].ManufacturingOrder,shape:"Box",selected:I,"attributes":[{"label":t.getView().getModel("i18n").getResourceBundle().getText("relatedOrdersMaterial"),"value":n[i].Material},{"label":t.getView().getModel("i18n").getResourceBundle().getText("relatedOrdersOrderType"),"value":n[i].ManufacturingOrderType},{"label":t.getView().getModel("i18n").getResourceBundle().getText("relatedOrdersWBS"),"value":n[i].WBSElement},{"label":t.getView().getModel("i18n").getResourceBundle().getText("relatedOrdersQuantityColumn"),"value":n[i].MfgOrderPlannedTotalQty}]}));I=false;for(var j=0;j<n.length;j++){if(n[j].MfgOrderSplitParentOrder===n[i].ManufacturingOrder){sap.ui.getCore().byId("idRelatedOrdersGraph").addLine(new sap.suite.ui.commons.networkgraph.Line({from:i,to:j}));}}}}},error:function(b){jQuery.sap.log.error(b.responseText);}});}},onPressTableRelatedOrders:function(E){sap.ui.getCore().byId("idRelatedOrdersInnerTable").setVisible(true);sap.ui.getCore().byId("idRelatedOrdersSmartTable").setShowRowCount(true);sap.ui.getCore().byId("idRelatedOrdersGraph").setVisible(false);sap.ui.getCore().byId("idRelatedOrdersNetworkGraphButton").setPressed(false);sap.ui.getCore().byId("idRelatedOrdersGraph").destroyAllElements();},onPressDisplayRelatedOrders:function(){var s=this.getView().getBindingContext();var S="/I_MfgOrderSplitParentOrderDet";var t=this;if(!this._oRelatedOrdersDialog){var o=new sap.ui.core.Fragment.load({name:"i2d.mpe.orders.manages1.fragments.RelatedOrdersDialog",controller:this});o.then(function(a){t._oRelatedOrdersDialog=a;var b=new J({source:"atomicCircle",orientation:"LeftRight",arrowPosition:"End",arrowOrientation:"ParentOf",nodeSpacing:55,mergeEdges:false});var i=new J({nodes:[],lines:[],groups:[]});var j=new J({MfgOrderSplitLeadingOrder:"",ManufacturingOrder:t.getView().getModel().getProperty(s+"/ManufacturingOrder"),MfgOrderSplitStatus:t.getView().getModel().getProperty(s+"/MfgOrderSplitStatus")});t.getView().setModel(i,"RelatedOrdersGraph");t.getView().setModel(b,"RelatedOrderGraphSettings");t.getView().setModel(j,"RelatedOrdersData");if(t.getView().getModel("RelatedOrdersData").getProperty("/MfgOrderSplitStatus")==="2"){sap.ui.getCore().byId("idRelatedOrdersSmartTable").setEnableAutoBinding(false);}else{sap.ui.getCore().byId("idRelatedOrdersSmartTable").setEnableAutoBinding(true);}t.getView().addDependent(a);var n=t.getView().getModel().createKey(S,{ManufacturingOrder:t.getView().getModel("RelatedOrdersData").getProperty("/ManufacturingOrder")});a.bindElement(n);a.open();});}else{if(this.getView().getModel().getProperty(s+"/ManufacturingOrder")!==this.getView().getModel("RelatedOrdersData").getProperty("/ManufacturingOrder")){sap.ui.getCore().byId("idRelatedOrdersInnerTable").setVisible(true);sap.ui.getCore().byId("idRelatedOrdersSmartTable").setShowRowCount(true);sap.ui.getCore().byId("idRelatedOrdersGraph").setVisible(false);sap.ui.getCore().byId("idRelatedOrdersNetworkGraphButton").setPressed(false);sap.ui.getCore().byId("idRelatedOrdersTableButton").setPressed(true);sap.ui.getCore().byId("idRelatedOrdersGraph").destroyAllElements();sap.ui.getCore().byId("idRelatedOrdersSmartTable").rebindTable(true);this.getView().getModel("RelatedOrdersData").setProperty("/ManufacturingOrder",this.getView().getModel().getProperty(s+"/ManufacturingOrder"));this.getView().getModel("RelatedOrdersData").setProperty("/MfgOrderSplitStatus",this.getView().getModel().getProperty(s+"/MfgOrderSplitStatus"));var C=this.getView().getModel().createKey(S,{ManufacturingOrder:this.getView().getModel("RelatedOrdersData").getProperty("/ManufacturingOrder")});this._oRelatedOrdersDialog.bindElement(C);}else{sap.ui.getCore().byId("idRelatedOrdersInnerTable").setVisible(true);sap.ui.getCore().byId("idRelatedOrdersSmartTable").setShowRowCount(true);sap.ui.getCore().byId("idRelatedOrdersGraph").setVisible(false);sap.ui.getCore().byId("idRelatedOrdersNetworkGraphButton").setPressed(false);sap.ui.getCore().byId("idRelatedOrdersTableButton").setPressed(true);sap.ui.getCore().byId("idRelatedOrdersGraph").destroyAllElements();sap.ui.getCore().byId("idRelatedOrdersSmartTable").rebindTable(true);}this._oRelatedOrdersDialog.open();}},onSerialNumbersLinkPress:function(E){var i=E.getSource().getBindingContext();var t=this;var u=new sap.ui.model.json.JSONModel({"I_SerialNumberManufacturingOrd":[]});if(!this._oPopoverSerialNumbers){this._oPopoverSerialNumbers=sap.ui.xmlfragment("i2d.mpe.orders.manages1.fragments.SerialNumbersPopover",this);this._oPopoverSerialNumbers.setModel(this.getView().getModel("i18n"),"i18n");}this._oPopoverSerialNumbers.openBy(E.getSource());this.getView().getModel().read(i.getPath(),{urlParameters:{"$expand":"to_SerialNumberManufacturingOrd"},success:function(o){u.getProperty("/I_SerialNumberManufacturingOrd").push.apply(u.getProperty("/I_SerialNumberManufacturingOrd"),o.to_SerialNumberManufacturingOrd.results);t._oPopoverSerialNumbers.setModel(u);},error:function(o){jQuery.sap.log.error(o.responseText);}});},onBeforeRebindRelatedOrdersTable:function(E){var b=E.getParameter("bindingParams");var t=this;b.events={"dataReceived":function(a){if(a.getParameter('data')['results'].length>0){var s=a.getParameter('data')['results'][0].MfgOrderSplitLeadingOrder;t.getView().getModel("RelatedOrdersData").setProperty("/MfgOrderSplitLeadingOrder",s);}}};var p=this.getView().getBindingContext();var o=new sap.ui.model.Filter("MfgOrderSplitParentOrder",sap.ui.model.FilterOperator.EQ,this.getView().getModel().getProperty(p+"/ManufacturingOrder"));b.filters.push(o);},onOrdSpcfcChangeCallBackObject:function(o){this.getView().getModel("objectView").setProperty("/oOrderSpecificChangeDetails",o);this.getModel("ActionButtonVisiblity").setProperty("/bIsOrderSpecificHoldAvailable",false);this.getModel("ActionButtonVisiblity").setProperty("/bIsDisplayOrderSpecificHoldAvailable",true);},onPressOrderSplit:function(E){m.initAndOpen({oi18nModel:this.getView().getModel("i18n"),oDataModel:this.getView().getModel(),oParentController:this,oSelectedOrder:this.getView().getBindingContext().getObject(),oSelectedOperation:this.getView().getModel("objectView").getProperty("/OperationForOrderSplit"),sSelectedButtonKey:E.getSource().getKey()});}});});
